<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<dom-module id="project-form-dialog">
    <template>
        <style include="dpm-theme">
            :host {
                text-align: center;
            }
        </style>

        <firebase-document id="document" data="{{project}}"></firebase-document>

        <paper-dialog id="dialog">
            <h2>Project</h2>
            <div>
                <iron-a11y-keys id="a11yEnter" keys="enter" on-keys-pressed="_save"></iron-a11y-keys>
                <form is="iron-form" id="form">
                    <paper-input type="text" name="name" label="Name" value="{{project.name}}" error-message="required" auto-validate required autofocus></paper-input>
                </form>
            </div>
            <div class="buttons">
                <paper-button danger dialog-dismiss>Cancel</paper-button>
                <paper-button raised primary on-tap="_save">Save</paper-button>
            </div>
        </paper-dialog>

        <paper-toast id="successToast" success></paper-toast>
        <paper-toast id="dangerToast" danger></paper-toast>
    </template>

    <script>
        Polymer({
            is: 'project-form-dialog',
            properties: {
              project: {
                type: Object
              }
            },
            ready: function() {
                this.$.a11yEnter.target = this.$.form;
            },
            open: function () {
              this.$.form.reset();
              this.$.document.reset();
              this.$.dialog.open();
            },
            _save: function() {
              this.$.document.save('/projects')
                  .then(function(response) {
                      this.$.dialog.close();
                      this.$.successToast.show("Saved Project: ''" + this.project.name + "'");
                  }.bind(this))
                  .catch(function(error) {
                      this.$.dangerToast.show("Unable to save Project: " + error.code);
                  }.bind(this));
            }
        });
    </script>
</dom-module>
